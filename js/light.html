<div id="light-container">
    <h3>Light Analysis Tool</h3>
    <p>Adjust brightness levels and analyze light intensity.</p>

    <div class="controls">
        <label>Brightness (0-100%):</label>
        <input type="range" id="light-brightness" min="0" max="100" value="50">
        <span id="brightness-value">50%</span>
        <br>

        <label>RGB Color:</label>
        <input type="color" id="light-color" value="#ffffff">
    </div>

    <canvas id="lightChart"></canvas>

    <p>Approximate Lux Level: <span id="lux-value">250 lux</span></p>
</div>

<script>
    (function () {
        console.log("✅ Light Analysis Tool loaded inside tools.html");

        // Ensure Chart.js is loaded dynamically
        if (typeof Chart === "undefined") {
            let script = document.createElement("script");
            script.src = "https://cdn.jsdelivr.net/npm/chart.js";
            script.defer = true;
            script.onload = initializeLightTool;
            document.body.appendChild(script);
        } else {
            initializeLightTool();
        }

        function initializeLightTool() {
            console.log("✅ Initializing Light Analysis Tool");

            let ctx = document.getElementById("lightChart").getContext("2d");
            let lightChart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: "Light Intensity (Lux)",
                            borderColor: "gold",
                            backgroundColor: "rgba(255, 215, 0, 0.5)",
                            data: [],
                            fill: true,
                        }
                    ]
                },
                options: {
                    animation: false,
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: "Time (s)" } },
                        y: { title: { display: true, text: "Lux Level" } }
                    }
                }
            });

            function updateLightSimulation() {
                let brightness = parseInt(document.getElementById("light-brightness").value);
                let color = document.getElementById("light-color").value;
                document.getElementById("brightness-value").textContent = brightness + "%";

                // Simulate Lux Calculation (arbitrary scaling)
                let lux = Math.round((brightness / 100) * 500);
                document.getElementById("lux-value").textContent = lux + " lux";

                // Update Graph Data
                let currentTime = new Date().getSeconds();
                if (lightChart.data.labels.length > 20) {
                    lightChart.data.labels.shift();
                    lightChart.data.datasets[0].data.shift();
                }
                lightChart.data.labels.push(currentTime);
                lightChart.data.datasets[0].data.push(lux);
                lightChart.update();
            }

            // Attach event listeners
            document.getElementById("light-brightness").addEventListener("input", updateLightSimulation);
            document.getElementById("light-color").addEventListener("input", updateLightSimulation);

            // Start real-time updates
            setInterval(updateLightSimulation, 1000);
        }
    })();
</script>
